import{a as f,t as n,g as v}from"./handleAuth-676db6f6.js";const{VITE_APP_SITE:g}={VITE_APP_SITE:"https://two023-dessert-webshop-json-server.onrender.com",BASE_URL:"/2023-Dessert-Webshop-Project/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};function E(){v()&&(location.href="index.html")}E();const l=document.getElementById("account"),r=document.getElementById("password"),i=document.getElementById("submit"),u=document.querySelectorAll("input");u.forEach(s=>{s.addEventListener("input",e=>{a(e.target)},!1)});function a(s){const{id:e,value:o,classList:t}=s,c=document.querySelector(`div[data-validation="${e}"]`);function d(){return t.remove("is-invalid"),t.add("is-valid"),!0}if(!o)t.add("is-invalid"),c.textContent="欄位不可空白";else if(e==="account")if(!/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/.test(o))t.remove("is-valid"),t.add("is-invalid"),c.textContent="信箱格式不正確";else return d();else if(e==="password")if(!/\w{6,}/.test(o))t.remove("is-valid"),t.add("is-invalid"),c.textContent="長度需在六個字以上";else return d();else return d()}i.addEventListener("click",p,!1);function p(){console.log(a(l),a(r)),a(l)&&a(r)&&A({email:l.value,password:r.value})}async function A(s){try{i.setAttribute("disabled",!0);const e=await f.post(`${g}/login`,s);i.removeAttribute("disabled");const{accessToken:o,user:t}=e.data;localStorage.setItem("token",o),localStorage.setItem("userData",JSON.stringify(t)),n("success",`歡迎您！${t.name}！`,"member.html#orders"),b()}catch(e){if(e.message==="Network Error")n("error","無法連接伺服器，請聯絡管理員");else{const{data:o}=e.response;o==="Incorrect password"?n("error","密碼錯誤"):o==="Cannot find user"&&n("error","用戶不存在"),r.value="",r.classList.remove("is-valid")}i.removeAttribute("disabled")}}function b(){u.forEach(s=>{s.value="",s.classList.remove("is-valid")})}
