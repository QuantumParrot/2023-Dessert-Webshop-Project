import{a as m,t as o,g as f}from"./handleAuth-9fafb369.js";const{VITE_APP_SITE:v}={VITE_APP_SITE:"https://two023-dessert-webshop-json-server.onrender.com",BASE_URL:"/2023-Dessert-Webshop-Project/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};function g(){f()&&(location.href="index.html")}g();const E=document.getElementById("account"),d=document.getElementById("password"),r=document.getElementById("submit"),n=document.querySelectorAll("input");n.forEach(e=>{e.addEventListener("input",t=>{l(t.target)},!1)});function l(e){const{id:t,value:a,classList:s}=e,i=document.querySelector(`div[data-validation="${t}"]`);function c(){return s.remove("is-invalid"),s.add("is-valid"),!0}if(!a)s.add("is-invalid"),i.textContent="欄位不可空白";else if(t==="account")if(!/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/.test(a))s.remove("is-valid"),s.add("is-invalid"),i.textContent="信箱格式不正確";else return c();else if(t==="password")if(!/\w{6,}/.test(a))s.remove("is-valid"),s.add("is-invalid"),i.textContent="長度需在六個字以上";else return c();else return c()}r.addEventListener("click",p,!1);function p(){n.forEach(e=>l(e)),[...n].every(e=>!!l(e))&&A({email:E.value,password:d.value})}async function A(e){try{r.setAttribute("disabled",!0);const t=await m.post(`${v}/login`,e);r.removeAttribute("disabled");const{accessToken:a,user:s}=t.data;localStorage.setItem("token",a),localStorage.setItem("userData",JSON.stringify(s)),o("success",`歡迎您！${s.name}！`,"member.html#orders"),b()}catch(t){if(t.message==="Network Error")o("error","無法連接伺服器，請聯絡管理員");else{const{data:a}=t.response;a==="Incorrect password"?o("error","密碼錯誤"):a==="Cannot find user"&&o("error","用戶不存在"),d.value="",d.classList.remove("is-valid")}r.removeAttribute("disabled")}}function b(){n.forEach(e=>{e.value="",e.classList.remove("is-valid")})}
